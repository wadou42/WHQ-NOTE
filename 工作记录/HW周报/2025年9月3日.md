# 上阶段TODO
## 方案上改进
- [ ] 修改搜索空间：
	- [x] 取消对-O0的搜索，保持全部打开
	- [x]  人工阅读gcc官方文档，筛选对性能无用的选项。例如`-fcx-fortran-rules`选项，该选项强制 GCC 在复数乘除运算中遵循 ​**​Fortran 标准​**​的语义规则（ISO/IEC 1539:1991），而非默认的 C/C++ 规则，对性能影响很小。

	- [ ] [doing]利用新的搜索空间收集数据，并按照方案中的方法，寻找非关键优化标志，进一步降低维度。
	- [ ]  关于非01优化选项——看12步筛选后的大小：如果比较小，可以在数据收集的时候就把01选项也收集了，然后预测阶段，把非01选项也加入到`<token>`，例如，对于优化选项`-fexcess-precision=[fast|standard|16]` ， 将`<-fexcess-precision=>` 加入token，进行预测。如果筛选后还是比较大，那就只在最后搜索的时候加上非01选项。（大数值类型？）
- [ ] 对预测结果进行多样性检测，避免起点太接近。
- [ ] 单分类-->多分类 (挑战--预测的准确性是否够)
- [ ] 搜索过程中加上预测，提前判断选项是否合适
## 实现上更改
- [ ] 扩展数据集（额外的程序）
- [ ] 将行号信息提取功能，从LLVM迁移到GCC（后方）
- [ ] 将搜索功能，更改为多方法并行搜索（挑战--doris多个软件并行会导致爆内存）

# DONE
### 无关选项问题
1. 完全无关的选项
* 只影响调试信息的
	```bash
	-fvar-tracking
	-fvar-tracking-assignments
	-fvar-tracking-assignments-toggle
	-fvar-tracking-uninit
	-fbranch-count-reg32 
	-fkeep-gc-roots-live
	-fkernel-pgo
	-fopt-info
	-gstatement-frontiers
	```
*  异常相关的
	```bash
	-fdelete-dead-exceptions
	-fexceptions
	-fnon-call-exceptions
	```
* 栈保护（安全性相关的）
```bash
  -fstack-clash-protection              
  -fstack-protector                     
  -fstack-protector-all                 
  -fstack-protector-explicit            
  -fstack-protector-strong              
```
* 其他
```bash
-fpack-struct
-fshort-wchar
-fwrapv
-fwrapv-pointer
```

线程问题，如果是单线程可以选择-fno-否则就打开
```bash
-fno-threadsafe-statics
```
余下 **180** 个左右。
# 问题
**模型推理速度**：
问题：在鲲鹏920高性能服务器上进行推理时，时间高达1000s/batch；在实验室服务器上，两张3090是约0.8s/batch; 在实验室cpu上是15s/batch. 经分析，瓶颈在推理推理部分。

**实验一：** 让一个未微调的t5-base模型进行测试，进行一个简单的推理， 输入内容如下：
```python
input_texts = [ 
	"def factorial(n): # Calculate factorial of n", 
	"def sum(a, b): # Add two numbers", 
	"def is_prime(n): # Check if n is prime", 
	"def fibonacci(n): # Compute nth Fibonacci number" 
	] * (num_samples // 4)
```
在鲲鹏CPU上(ARM架构）：
![[Pasted image 20250903143026.png]]
在实验室服务器上（x86架构）：
![[Pasted image 20250903144529.png]]
结论：在简单推理下，两个CPU差距并不明显，基本在同一个数量级



**实验二：** 让一个未微调的t5-base模型进行测试，进行一个复杂的推理， 推理内容为重构一个100+行的函数。
在鲲鹏CPU上(ARM架构）：
![[Pasted image 20250903154427.png]]
在实验室服务器上（x86架构）：
![[Pasted image 20250903152959.png]]
时间相差大概**一个数量级**，实际进行推理的时候，更接近实验二的情况。
