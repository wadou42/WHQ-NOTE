## 新数据集收集

搜索空间： **所有的01选项**
搜索程序：mysql、rocksdb、cbench以及**新增的faiss**

### 搜索结果与数据收集结果：
**搜索结果：**
截止到SRTuner目前调优300轮次的结果：
rocksdb：1.047
mysql： 1.33 
faiss：1.1
cbench： 从0.9-1.5不等
**结论**： 扩充优化空间确实可以提供更高的上限


**收集结果：**
为了减小误差，通常会筛选运行时间大于50ms的instance，因此下面只讨论函数执行时间**大于50ms**的instance

**5w条数据，约1.9w**条正instance，与之前的数据集对比，收集数据更加的均匀

注：下图是统计每个函数中正样本占比 的分布，例如func a在20条opts下是优于-O3，在30条opts下是劣于-O3的，那么他的正样本就是0.4 。做图统计的是数据集中所有函数正样本占比的分布，右图是之前收集的数据。
![[现在的数据加速比分布图.png|550]]  ![[之前的加速比对比图.png|550]]


### 搜索遇到的问题与解决：
**问题**：项目级别优于-O3的比例太少了，例如第一次收集数据时rockddb200+轮没有一轮比-O3好

**解决方法**：利用约束求解工具，将约束大致分为一下三个级别
	* 编译不通过
	* 编译通过但是执行时间约是-O3的数倍（认为这类优化配置完全没有优化潜力）
	* 编译通过但是执行时间是-O3的1.5倍以上（认为这类优化配置潜力较低）

解决这些约束，实际就是固定住一些优化选项，或者避免一些优化组合出现，从而提高搜索的效率。例如，在约束文件中添加`-fno-inline`可以保证搜索过程中inline强制打开。

**效果1**：在收集faiss的数据过程中，未使用约束求解的方法时，前30轮接近一半的执行时间是-O3的两倍以上，**没有任何一轮是超越-O3的**。  使用约束求解方法后，300轮收集数据中，只有一轮执行时间是-O3的两倍以上，**有十分之一的比例是执行时间是小于-O3的**。

**效果2**：在对scann进行约减的过程中，随机生成了70个优化选项进行测试，其中有15个效果优于-O3， 并且有两个为 **8.4%  和 8.6%**， 而之前的方法随机搜索170轮效果最好的只有**3.6%**
![[Randon_scann_170.png]]